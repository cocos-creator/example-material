{"version":3,"sources":["file:///D:/material-examples/show-material/assets/scripts/jellyfish/jellyfish.ts"],"names":["_decorator","Component","Quat","Vec3","ccclass","property","_pos","_quat","JellyFish","onLoad","x","Math","random","range","y","z","node","setPosition","newDst","_dstPos","getPosition","temp","set","subtract","_dir","angle","atan2","_dstRot","sin","w","cos","normalize","multiplyScalar","speed","_changing","_time","update","dt","mixDuration","setRotation","ratio","getRotation","lerp","add","length"],"mappings":"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","sourcesContent":["import { _decorator, Component, Quat, Vec3 } from 'cc';\r\nconst { ccclass, property } = _decorator;\r\n\r\nconst _pos = new Vec3();\r\nconst _quat = new Quat();\r\n\r\n@ccclass('JellyFish')\r\nexport class JellyFish extends Component {\r\n\r\n    @property\r\n    public speed = 0.01;\r\n\r\n    @property\r\n    public mixDuration = 1;\r\n\r\n    @property\r\n    public range = 50;\r\n\r\n    public _dstPos = new Vec3();\r\n    public _dstRot = new Quat();\r\n    public _dir = new Vec3();\r\n    public _changing = true;\r\n    public _time = 0;\r\n\r\n    public onLoad () {\r\n        const x = Math.random() * this.range - this.range / 2;\r\n        const y = Math.random() * this.range - this.range / 2;\r\n        const z = Math.random() * this.range - this.range / 2;\r\n        this.node.setPosition(x, y, z);\r\n        this.newDst();\r\n    }\r\n\r\n    public newDst () {\r\n        this._dstPos.x = Math.random() * this.range - this.range / 2;\r\n        this._dstPos.y = Math.random() * this.range - this.range / 2;\r\n        this._dstPos.z = Math.random() * this.range - this.range / 2;\r\n\r\n        this.node.getPosition(_pos);\r\n        const temp = new Vec3();\r\n        temp.set(this._dstPos);\r\n        this._dstPos.subtract(_pos);\r\n        this._dir.set(this._dstPos);\r\n        this._dstPos.set(temp);\r\n        const angle = Math.atan2( this._dir.x, this._dir.z );\r\n        this._dstRot.x = 0;\r\n        this._dstRot.y = 1 * Math.sin( angle / 2 );\r\n        this._dstRot.z = 0;\r\n        this._dstRot.w = Math.cos( angle / 2 );\r\n        Quat.normalize(this._dstRot, this._dstRot);\r\n\r\n        // let angle = cc.Vec3.angle(_pos, this._dstPos);\r\n        // this._dstRot.x = _pos.x * Math.sin(angle/2);\r\n        // this._dstRot.y = _pos.y * Math.sin(angle/2);\r\n        // this._dstRot.z = _pos.z * Math.sin(angle/2);\r\n        // this._dstRot.w = Math.cos(angle/2);\r\n        // cc.Quat.normalize(this._dstRot, this._dstRot);\r\n\r\n        // this._dstPos.sub(_pos, this._dir);\r\n        this._dir.normalize();\r\n        this._dir.multiplyScalar(this.speed);\r\n\r\n        this._changing = true;\r\n        this._time = 0;\r\n    }\r\n\r\n    public update (dt: number) {\r\n        this._time += dt;\r\n        if (this._changing) {\r\n            if (this._time >= this.mixDuration) {\r\n                this.node.setRotation(this._dstRot);\r\n                this._changing = false;\r\n            }\r\n            else {\r\n                const ratio = this._time / this.mixDuration;\r\n                this.node.getRotation(_quat);\r\n                _quat.lerp(this._dstRot, ratio);\r\n\r\n                this.node.setRotation(_quat);\r\n            }\r\n        }\r\n\r\n        this.node.getPosition(_pos);\r\n        _pos.add(this._dir);\r\n        this.node.setPosition(_pos);\r\n\r\n        _pos.subtract(this._dstPos);\r\n\r\n        if (_pos.length() < 5) {\r\n            this.newDst();\r\n        }\r\n    }\r\n}\r\n"]}