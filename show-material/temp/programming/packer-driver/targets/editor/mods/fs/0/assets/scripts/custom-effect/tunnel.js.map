{"version":3,"sources":["file:///D:/material-examples/show-material/assets/scripts/custom-effect/tunnel.ts"],"names":["_decorator","Component","ModelComponent","Vec2","Vec4","director","eventManager","ccclass","Tunnel","start","comps","getComponentsInChildren","comp","mat","material","pass","passes","_colorHandles","push","getHandle","_borderHandles","_passes","update","time","getTotalFrames","margin","Math","PI","abs","cos","_color","y","z","_border","x","len","length","i","setUniform","onDisable","removeAllListeners"],"mappings":";;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,c,OAAAA,c;AAAgBC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,Q,OAAAA,Q;AAAUC,MAAAA,Y,OAAAA,Y;;;;;;;OAChE;AAAEC,QAAAA;AAAF,O,GAAcP,U;;wBAGPQ,M,WADZD,OAAO,CAAC,QAAD,C,yBAAR,MACaC,MADb,SAC4BP,SAD5B,CACsC;AAAA;AAAA;;AAAA,2CAEhB,EAFgB;;AAAA,iDAGV,EAHU;;AAAA,kDAIT,EAJS;;AAAA,0CAMjB,IAAIG,IAAJ,CAAS,CAAT,EAAY,CAAZ,EAAe,CAAf,EAAkB,CAAlB,CANiB;;AAAA,2CAOhB,IAAID,IAAJ,CAAS,CAAT,EAAY,CAAZ,CAPgB;AAAA;;AAS3BM,QAAAA,KAAK,GAAI;AACZ,gBAAMC,KAAK,GAAG,KAAKC,uBAAL,CAA6BT,cAA7B,CAAd;;AACA,eAAK,MAAMU,IAAX,IAAmBF,KAAnB,EAA0B;AACtB,kBAAMG,GAAG,GAAGD,IAAI,CAACE,QAAjB;AACA,kBAAMC,IAAI,GAAGF,GAAG,CAACG,MAAJ,CAAW,CAAX,CAAb;;AACA,iBAAKC,aAAL,CAAmBC,IAAnB,CAAwBH,IAAI,CAACI,SAAL,CAAe,OAAf,CAAxB;;AACA,iBAAKC,cAAL,CAAoBF,IAApB,CAAyBH,IAAI,CAACI,SAAL,CAAe,QAAf,CAAzB;;AACA,iBAAKE,OAAL,CAAaH,IAAb,CAAkBH,IAAlB;AACH;AACJ;;AAEMO,QAAAA,MAAM,GAAI;AACb,gBAAMC,IAAI,GAAGlB,QAAQ,CAACmB,cAAT,KAA4B,GAAzC;AACA,gBAAMC,MAAM,GAAGF,IAAI,IAAIG,IAAI,CAACC,EAAL,GAAU,CAAd,CAAJ,GAAuBD,IAAI,CAACC,EAA5B,GAAiC,GAAjC,GAAuCD,IAAI,CAACE,GAAL,CAASF,IAAI,CAACG,GAAL,CAASN,IAAT,CAAT,IAA2B,GAAjF;AACA,eAAKO,MAAL,CAAYC,CAAZ,GAAgB,KAAKD,MAAL,CAAYE,CAAZ,GAAgBP,MAAM,GAAG,EAAzC;AACA,eAAKQ,OAAL,CAAaC,CAAb,GAAiB,KAAKD,OAAL,CAAaF,CAAb,GAAiBN,MAAlC;AAEA,gBAAMU,GAAG,GAAG,KAAKd,OAAL,CAAae,MAAzB;;AACA,eAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGF,GAApB,EAAyBE,CAAC,EAA1B,EAA8B;AAC1B,iBAAKhB,OAAL,CAAagB,CAAb,EAAgBC,UAAhB,CAA2B,KAAKrB,aAAL,CAAmBoB,CAAnB,CAA3B,EAAkD,KAAKP,MAAvD;;AACA,iBAAKT,OAAL,CAAagB,CAAb,EAAgBC,UAAhB,CAA2B,KAAKlB,cAAL,CAAoBiB,CAApB,CAA3B,EAAmD,KAAKJ,OAAxD;AACH;AACJ;;AAEMM,QAAAA,SAAS,GAAI;AAChBjC,UAAAA,YAAY,CAACkC,kBAAb;AACH;;AAnCiC,O","sourcesContent":["import { _decorator, Component, ModelComponent, Vec2, Vec4, director, eventManager } from 'cc';\r\nconst { ccclass } = _decorator;\r\n\r\n@ccclass('Tunnel')\r\nexport class Tunnel extends Component {\r\n\r\n    private _passes = [];\r\n    private _colorHandles = [];\r\n    private _borderHandles = [];\r\n\r\n    private _color = new Vec4(1, 0, 0, 1);\r\n    private _border = new Vec2(0, 0);\r\n\r\n    public start () {\r\n        const comps = this.getComponentsInChildren(ModelComponent);\r\n        for (const comp of comps) {\r\n            const mat = comp.material;\r\n            const pass = mat.passes[0];\r\n            this._colorHandles.push(pass.getHandle('color'));\r\n            this._borderHandles.push(pass.getHandle('border'));\r\n            this._passes.push(pass);\r\n        }\r\n    }\r\n\r\n    public update () {\r\n        const time = director.getTotalFrames() * 0.1;\r\n        const margin = time % (Math.PI * 4) > Math.PI ? 0.1 : Math.abs(Math.cos(time)) * 0.1;\r\n        this._color.y = this._color.z = margin * 10;\r\n        this._border.x = this._border.y = margin;\r\n\r\n        const len = this._passes.length;\r\n        for (let i = 0; i < len; i++) {\r\n            this._passes[i].setUniform(this._colorHandles[i], this._color);\r\n            this._passes[i].setUniform(this._borderHandles[i], this._border);\r\n        }\r\n    }\r\n\r\n    public onDisable () {\r\n        eventManager.removeAllListeners();\r\n    }\r\n}\r\n"]}